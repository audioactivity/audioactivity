/*
 * Copyright (c) 2015, Markus Brandt
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted
 * provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this list of conditions
 * and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice, this list of
 * conditions and the following disclaimer in the documentation and/or other materials provided
 * with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
 * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
 * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

package de.tudarmstadt.seemoo.mbr.audioactivity.core;

public class Gnuradio {
    private static final int[] CRC32_TABLE = {
        0x00000000, 0x04C11DB7, 0x09823B6E, 0x0D4326D9,
        0x130476DC, 0x17C56B6B, 0x1A864DB2, 0x1E475005,
        0x2608EDB8, 0x22C9F00F, 0x2F8AD6D6, 0x2B4BCB61,
        0x350C9B64, 0x31CD86D3, 0x3C8EA00A, 0x384FBDBD,
        0x4C11DB70, 0x48D0C6C7, 0x4593E01E, 0x4152FDA9,
        0x5F15ADAC, 0x5BD4B01B, 0x569796C2, 0x52568B75,
        0x6A1936C8, 0x6ED82B7F, 0x639B0DA6, 0x675A1011,
        0x791D4014, 0x7DDC5DA3, 0x709F7B7A, 0x745E66CD,
        0x9823B6E0, 0x9CE2AB57, 0x91A18D8E, 0x95609039,
        0x8B27C03C, 0x8FE6DD8B, 0x82A5FB52, 0x8664E6E5,
        0xBE2B5B58, 0xBAEA46EF, 0xB7A96036, 0xB3687D81,
        0xAD2F2D84, 0xA9EE3033, 0xA4AD16EA, 0xA06C0B5D,
        0xD4326D90, 0xD0F37027, 0xDDB056FE, 0xD9714B49,
        0xC7361B4C, 0xC3F706FB, 0xCEB42022, 0xCA753D95,
        0xF23A8028, 0xF6FB9D9F, 0xFBB8BB46, 0xFF79A6F1,
        0xE13EF6F4, 0xE5FFEB43, 0xE8BCCD9A, 0xEC7DD02D,
        0x34867077, 0x30476DC0, 0x3D044B19, 0x39C556AE,
        0x278206AB, 0x23431B1C, 0x2E003DC5, 0x2AC12072,
        0x128E9DCF, 0x164F8078, 0x1B0CA6A1, 0x1FCDBB16,
        0x018AEB13, 0x054BF6A4, 0x0808D07D, 0x0CC9CDCA,
        0x7897AB07, 0x7C56B6B0, 0x71159069, 0x75D48DDE,
        0x6B93DDDB, 0x6F52C06C, 0x6211E6B5, 0x66D0FB02,
        0x5E9F46BF, 0x5A5E5B08, 0x571D7DD1, 0x53DC6066,
        0x4D9B3063, 0x495A2DD4, 0x44190B0D, 0x40D816BA,
        0xACA5C697, 0xA864DB20, 0xA527FDF9, 0xA1E6E04E,
        0xBFA1B04B, 0xBB60ADFC, 0xB6238B25, 0xB2E29692,
        0x8AAD2B2F, 0x8E6C3698, 0x832F1041, 0x87EE0DF6,
        0x99A95DF3, 0x9D684044, 0x902B669D, 0x94EA7B2A,
        0xE0B41DE7, 0xE4750050, 0xE9362689, 0xEDF73B3E,
        0xF3B06B3B, 0xF771768C, 0xFA325055, 0xFEF34DE2,
        0xC6BCF05F, 0xC27DEDE8, 0xCF3ECB31, 0xCBFFD686,
        0xD5B88683, 0xD1799B34, 0xDC3ABDED, 0xD8FBA05A,
        0x690CE0EE, 0x6DCDFD59, 0x608EDB80, 0x644FC637,
        0x7A089632, 0x7EC98B85, 0x738AAD5C, 0x774BB0EB,
        0x4F040D56, 0x4BC510E1, 0x46863638, 0x42472B8F,
        0x5C007B8A, 0x58C1663D, 0x558240E4, 0x51435D53,
        0x251D3B9E, 0x21DC2629, 0x2C9F00F0, 0x285E1D47,
        0x36194D42, 0x32D850F5, 0x3F9B762C, 0x3B5A6B9B,
        0x0315D626, 0x07D4CB91, 0x0A97ED48, 0x0E56F0FF,
        0x1011A0FA, 0x14D0BD4D, 0x19939B94, 0x1D528623,
        0xF12F560E, 0xF5EE4BB9, 0xF8AD6D60, 0xFC6C70D7,
        0xE22B20D2, 0xE6EA3D65, 0xEBA91BBC, 0xEF68060B,
        0xD727BBB6, 0xD3E6A601, 0xDEA580D8, 0xDA649D6F,
        0xC423CD6A, 0xC0E2D0DD, 0xCDA1F604, 0xC960EBB3,
        0xBD3E8D7E, 0xB9FF90C9, 0xB4BCB610, 0xB07DABA7,
        0xAE3AFBA2, 0xAAFBE615, 0xA7B8C0CC, 0xA379DD7B,
        0x9B3660C6, 0x9FF77D71, 0x92B45BA8, 0x9675461F,
        0x8832161A, 0x8CF30BAD, 0x81B02D74, 0x857130C3,
        0x5D8A9099, 0x594B8D2E, 0x5408ABF7, 0x50C9B640,
        0x4E8EE645, 0x4A4FFBF2, 0x470CDD2B, 0x43CDC09C,
        0x7B827D21, 0x7F436096, 0x7200464F, 0x76C15BF8,
        0x68860BFD, 0x6C47164A, 0x61043093, 0x65C52D24,
        0x119B4BE9, 0x155A565E, 0x18197087, 0x1CD86D30,
        0x029F3D35, 0x065E2082, 0x0B1D065B, 0x0FDC1BEC,
        0x3793A651, 0x3352BBE6, 0x3E119D3F, 0x3AD08088,
        0x2497D08D, 0x2056CD3A, 0x2D15EBE3, 0x29D4F654,
        0xC5A92679, 0xC1683BCE, 0xCC2B1D17, 0xC8EA00A0,
        0xD6AD50A5, 0xD26C4D12, 0xDF2F6BCB, 0xDBEE767C,
        0xE3A1CBC1, 0xE760D676, 0xEA23F0AF, 0xEEE2ED18,
        0xF0A5BD1D, 0xF464A0AA, 0xF9278673, 0xFDE69BC4,
        0x89B8FD09, 0x8D79E0BE, 0x803AC667, 0x84FBDBD0,
        0x9ABC8BD5, 0x9E7D9662, 0x933EB0BB, 0x97FFAD0C,
        0xAFB010B1, 0xAB710D06, 0xA6322BDF, 0xA2F33668,
        0xBCB4666D, 0xB8757BDA, 0xB5365D03, 0xB1F740B4
    };

    // taken from GNU Radio packet_utils.py
    private static final byte[] GNURADIO_MASK = {
            -1, 63, 0, 16, 0, 12, 0, 5, -64, 3, 16, 1, -52, 0, 85, -64, 63, 16, 16, 12,
            12, 5, -59, -61, 19, 17, -51, -52, 85, -107, -1, 47, 0, 28, 0, 9, -64, 6, -48,
            2, -36, 1, -103, -64, 106, -48, 47, 28, 28, 9, -55, -58, -42, -46, -34, -35,
            -104, 89, -86, -70, -1, 51, 0, 21, -64, 15, 16, 4, 12, 3, 69, -63, -13, 16, 69,
            -52, 51, 21, -43, -49, 31, 20, 8, 15, 70, -124, 50, -29, 85, -119, -1, 38, -64,
            26, -48, 11, 28, 7, 73, -62, -74, -47, -74, -36, 118, -39, -26, -38, -54, -37,
            23, 27, 78, -117, 116, 103, 103, 106, -86, -81, 63, 60, 16, 17, -52, 12, 85,
            -59, -1, 19, 0, 13, -64, 5, -112, 3, 44, 1, -35, -64, 89, -112, 58, -20, 19,
            13, -51, -59, -107, -109, 47, 45, -36, 29, -103, -55, -86, -42, -1, 30, -64, 8,
            80, 6, -68, 2, -15, -63, -124, 80, 99, 124, 41, -31, -34, -56, 88, 86, -70,
            -66, -13, 48, 69, -44, 51, 31, 85, -56, 63, 22, -112, 14, -20, 4, 77, -61, 117,
            -111, -25, 44, 74, -99, -9, 41, -122, -98, -30, -24, 73, -114, -74, -28, 118,
            -53, 102, -41, 106, -34, -81, 24, 124, 10, -95, -57, 56, 82, -110, -67, -83,
            -79, -67, -76, 113, -73, 100, 118, -85, 102, -1, 106, -64, 47, 16, 28, 12, 9,
            -59, -58, -45, 18, -35, -51, -103, -107, -86, -17, 63, 12, 16, 5, -52, 3, 21,
            -63, -49, 16, 84, 12, 63, 69, -48, 51, 28, 21, -55, -49, 22, -44, 14, -33, 68,
            88, 51, 122, -107, -29, 47, 9, -36, 6, -39, -62, -38, -47, -101, 28, 107, 73,
            -17, 118, -52, 38, -43, -38, -33, 27, 24, 11, 74, -121, 119, 34, -90, -103,
            -70, -22, -13, 15, 5, -60, 3, 19, 65, -51, -16, 85, -124, 63, 35, 80, 25, -4,
            10, -63, -57, 16, 82, -116, 61, -91, -47, -69, 28, 115, 73, -27, -10, -53, 6,
            -41, 66, -34, -79, -104, 116, 106, -89, 111, 58, -84, 19, 61, -51, -47, -107,
            -100, 111, 41, -20, 30, -51, -56, 85, -106, -65, 46, -16, 28, 68, 9, -13, 70,
            -59, -14, -45, 5, -99, -61, 41, -111, -34, -20, 88, 77, -6, -75, -125, 55, 33,
            -42, -104, 94, -22, -72, 79, 50, -76, 21, -73, 79, 54, -76, 22, -9, 78, -58,
            -76, 82, -9, 125, -122, -95, -94, -8, 121, -126, -94, -31, -71, -120, 114, -26,
            -91, -118, -5, 39, 3, 90, -127, -5, 32, 67, 88, 49, -6, -108, 67, 47, 113, -36,
            36, 89, -37, 122, -37, 99, 27, 105, -53, 110, -41, 108, 94, -83, -8, 125, -126,
            -95, -95, -72, 120, 114, -94, -91, -71, -69, 50, -13, 85, -123, -1, 35, 0, 25,
            -64, 10, -48, 7, 28, 2, -119, -63, -90, -48, 122, -36, 35, 25, -39, -54, -38,
            -41, 27, 30, -117, 72, 103, 118, -86, -90, -1, 58, -64, 19, 16, 13, -52, 5,
            -107, -61, 47, 17, -36, 12, 89, -59, -6, -45, 3, 29, -63, -55, -112, 86, -20,
            62, -51, -48, 85, -100, 63, 41, -48, 30, -36, 8, 89, -58, -70, -46, -13, 29,
            -123, -55, -93, 22, -7, -50, -62, -44, 81, -97, 124, 104, 33, -18, -104, 76,
            106, -75, -17, 55, 12, 22, -123, -50, -29, 20, 73, -49, 118, -44, 38, -33, 90,
            -40, 59, 26, -109, 75, 45, -9, 93, -122, -71, -94, -14, -7, -123, -126, -29,
            33, -119, -40, 102, -38, -86, -37, 63, 27, 80, 11, 124, 7, 97, -62, -88, 81,
            -66, -68, 112, 113, -28, 36, 75, 91, 119, 123, 102, -93, 106, -7, -17, 2, -52,
            1, -107, -64, 111, 16, 44, 12, 29, -59, -55, -109, 22, -19, -50, -51, -108, 85,
            -81, 127, 60, 32, 17, -40, 12, 90, -123, -5, 35, 3, 89, -63, -6, -48, 67, 28,
            49, -55, -44, 86, -33, 126, -40, 32, 90, -104, 59, 42, -109, 95, 45, -8, 29,
            -126, -119, -95, -90, -8, 122, -62, -93, 17, -71, -52, 114, -43, -27, -97, 11,
            40, 7, 94, -126, -72, 97, -78, -88, 117, -66, -89, 48, 122, -108, 35, 47, 89,
            -36, 58, -39, -45, 26, -35, -53, 25, -105, 74, -18, -73, 12, 118, -123, -26,
            -29, 10, -55, -57, 22, -46, -114, -35, -92, 89, -69, 122, -13, 99, 5, -23, -61,
            14, -47, -60, 92, 83, 121, -3, -30, -63, -119, -112, 102, -20, 42, -51, -33,
            21, -104, 15, 42, -124, 31, 35, 72, 25, -10, -118, -58, -25, 18, -54, -115,
            -105, 37, -82, -101, 60, 107, 81, -17, 124, 76, 33, -11, -40, 71, 26, -78,
            -117, 53, -89, 87, 58, -66, -109, 48, 109, -44, 45, -97, 93, -88, 57, -66,
            -110, -16, 109, -124, 45, -93, 93, -71, -7, -78, -62, -11, -111, -121, 44, 98,
            -99, -23, -87, -114, -2, -28, 64, 75, 112, 55, 100, 22, -85, 78, -1, 116, 64,
            39, 112, 26, -92, 11, 59, 71, 83, 114, -67, -27, -79, -117, 52, 103, 87, 106,
            -66, -81, 48, 124, 20, 33, -49, 88, 84, 58, -65, 83, 48, 61, -44, 17, -97, 76,
            104, 53, -18, -105, 12, 110, -123, -20, 99, 13, -23, -59, -114, -45, 36, 93,
            -37, 121, -101, 98, -21, 105, -113, 110, -28, 44, 75, 93, -9, 121, -122, -94,
            -30, -7, -119, -126, -26, -31, -118, -56, 103, 22, -86, -114, -1, 36, 64, 27,
            112, 11, 100, 7, 107, 66, -81, 113, -68, 36, 113, -37, 100, 91, 107, 123, 111,
            99, 108, 41, -19, -34, -51, -104, 85, -86, -65, 63, 48, 16, 20, 12, 15, 69,
            -60, 51, 19, 85, -51, -1, 21, -128, 15, 32, 4, 24, 3, 74, -127, -9, 32, 70,
            -104, 50, -22, -107, -113, 47, 36, 28, 27, 73, -53, 118, -41, 102, -34, -86,
            -40, 127, 26, -96, 11, 56, 7, 82, -126, -67, -95, -79, -72, 116, 114, -89, 101,
            -70, -85, 51, 63, 85, -48, 63, 28, 16, 9, -52, 6, -43, -62, -33, 17, -104, 12,
            106, -123, -17, 35, 12, 25, -59, -54, -45, 23, 29, -50, -119, -108, 102, -17,
            106, -52, 47, 21, -36, 15, 25, -60, 10, -45, 71, 29, -14, -119, -123, -90, -29,
            58, -55, -45, 22, -35, -50, -39, -108, 90, -17, 123, 12, 35, 69, -39, -13, 26,
            -59, -53, 19, 23, 77, -50, -75, -108, 119, 47, 102, -100, 42, -23, -33, 14,
            -40, 4, 90, -125, 123, 33, -29, 88, 73, -6, -74, -61, 54, -47, -42, -36, 94,
            -39, -8, 90, -62, -69, 17, -77, 76, 117, -11, -25, 7, 10, -126, -121, 33, -94,
            -104, 121, -86, -94, -1, 57, -128, 18, -32, 13, -120, 5, -90, -125, 58, -31,
            -45, 8, 93, -58, -71, -110, -14, -19, -123, -115, -93, 37, -71, -37, 50, -37,
            85, -101, 127, 43, 96, 31, 104, 8, 46, -122, -100, 98, -23, -23, -114, -50,
            -28, 84, 75, 127, 119, 96, 38, -88, 26, -2, -117, 0, 103, 64, 42, -80, 31, 52,
            8, 23, 70, -114, -78, -28, 117, -117, 103, 39, 106, -102, -81, 43, 60, 31, 81,
            -56, 60, 86, -111, -2, -20, 64, 77, -16, 53, -124, 23, 35, 78, -103, -12, 106,
            -57, 111, 18, -84, 13, -67, -59, -79, -109, 52, 109, -41, 109, -98, -83, -88,
            125, -66, -95, -80, 120, 116, 34, -89, 89, -70, -70, -13, 51, 5, -43, -61, 31,
            17, -56, 12, 86, -123, -2, -29, 0, 73, -64, 54, -48, 22, -36, 14, -39, -60, 90,
            -45, 123, 29, -29, 73, -119, -10, -26, -58, -54, -46, -41, 29, -98, -119, -88,
            102, -2, -86, -64, 127, 16, 32, 12, 24, 5, -54, -125, 23, 33, -50, -104, 84,
            106, -65, 111, 48, 44, 20, 29, -49, 73, -108, 54, -17, 86, -52, 62, -43, -48,
            95, 28, 56, 9, -46, -122, -35, -94, -39, -71, -102, -14, -21, 5, -113, 67, 36,
            49, -37, 84, 91, 127, 123, 96, 35, 104, 25, -18, -118, -52, 103, 21, -22, -113,
            15, 36, 4, 27, 67, 75, 113, -9, 100, 70, -85, 114, -1, 101, -128, 43, 32, 31,
            88, 8, 58, -122, -109, 34, -19, -39, -115, -102, -27, -85, 11, 63, 71, 80, 50,
            -68, 21, -79, -49, 52, 84, 23, 127, 78, -96, 52, 120, 23, 98, -114, -87, -92,
            126, -5, 96, 67, 104, 49, -18, -108, 76, 111, 117, -20, 39, 13, -38, -123,
            -101, 35, 43, 89, -33, 122, -40, 35, 26, -103, -53, 42, -41, 95, 30, -72, 8,
            114, -122, -91, -94, -5, 57, -125, 82, -31, -3, -120, 65, -90, -80, 122, -12,
            35, 7, 89, -62, -70, -47, -77, 28, 117, -55, -25, 22, -54, -114, -41, 36, 94,
            -101, 120, 107, 98, -81, 105, -68, 46, -15, -36, 68, 89, -13, 122, -59, -29,
            19, 9, -51, -58, -43, -110, -33, 45, -104, 29, -86, -119, -65, 38, -16, 26,
            -60, 11, 19, 71, 77, -14, -75, -123, -73, 35, 54, -103, -42, -22, -34, -49, 24,
            84, 10, -65, 71, 48, 50, -108, 21, -81, 79, 60, 52, 17, -41, 76, 94, -75, -8,
            119, 2, -90, -127, -70, -32, 115, 8, 37, -58, -101, 18, -21, 77, -113, 117,
            -92, 39, 59, 90, -109, 123, 45, -29, 93, -119, -7, -90, -62, -6, -47, -125, 28,
            97, -55, -24, 86, -50, -66, -44, 112, 95, 100, 56, 43, 82, -97, 125, -88, 33,
            -66, -104, 112, 106, -92, 47, 59, 92, 19, 121, -51, -30, -43, -119, -97, 38,
            -24, 26, -50, -117, 20, 103, 79, 106, -76, 47, 55, 92, 22, -71, -50, -14, -44,
            69, -97, 115, 40, 37, -34, -101, 24, 107, 74, -81, 119, 60, 38, -111, -38, -20,
            91, 13, -5, 69, -125, 115, 33, -27, -40, 75, 26, -73, 75, 54, -73, 86, -10,
            -66, -58, -16, 82, -60, 61, -109, 81, -83, -4, 125, -127, -31, -96, 72, 120,
            54, -94, -106, -7, -82, -62, -4, 81, -127, -4, 96, 65, -24, 48, 78, -108, 52,
            111, 87, 108, 62, -83, -48, 125, -100, 33, -87, -40, 126, -38, -96, 91, 56, 59,
            82, -109, 125, -83, -31, -67, -120, 113, -90, -92, 122, -5, 99, 3, 105, -63,
            -18, -48, 76, 92, 53, -7, -41, 2, -34, -127, -104, 96, 106, -88, 47, 62, -100,
            16, 105, -52, 46, -43, -36, 95, 25, -8, 10, -62, -121, 17, -94, -116, 121, -91,
            -30, -5, 9, -125, 70, -31, -14, -56, 69, -106, -77, 46, -11, -36, 71, 25, -14,
            -118, -59, -89, 19, 58, -115, -45, 37, -99, -37, 41, -101, 94, -21, 120, 79,
            98, -76, 41, -73, 94, -10, -72, 70, -14, -78, -59, -75, -109, 55, 45, -42, -99,
            -98, -23, -88, 78, -2, -76, 64, 119, 112, 38, -92, 26, -5, 75, 3, 119, 65, -26,
            -80, 74, -12, 55, 7, 86, -126, -66, -31, -80, 72, 116, 54, -89, 86, -6, -66,
            -61, 48, 81, -44, 60, 95, 81, -8, 60, 66, -111, -15, -84, 68, 125, -13, 97,
            -123, -24, 99, 14, -87, -60, 126, -45, 96, 93, -24, 57, -114, -110, -28, 109,
            -117, 109, -89, 109, -70, -83, -77, 61, -75, -47, -73, 28, 118, -119, -26, -26,
            -54, -54, -41, 23, 30, -114, -120, 100, 102, -85, 106, -1, 111, 0, 44, 0, 29,
            -64, 9, -112, 6, -20, 2, -51, -63, -107, -112, 111, 44, 44, 29, -35, -55, -103,
            -106, -22, -18, -49, 12, 84, 5, -1, 67, 0, 49, -64, 20, 80, 15, 124, 4, 33,
            -61, 88, 81, -6, -68, 67, 49, -15, -44, 68, 95, 115, 120, 37, -30, -101, 9,
            -85, 70, -1, 114, -64, 37, -112, 27, 44, 11, 93, -57, 121, -110, -94, -19, -71,
            -115, -78, -27, -75, -117, 55, 39, 86, -102, -66, -21, 48, 79, 84, 52, 63, 87,
            80, 62, -68, 16, 113, -52, 36, 85, -37, 127, 27, 96, 11, 104, 7, 110, -126,
            -84, 97, -67, -24, 113, -114, -92, 100, 123, 107, 99, 111, 105, -20, 46, -51,
            -36, 85, -103, -1, 42, -64, 31, 16, 8, 12, 6, -123, -62, -29, 17, -119, -52,
            102, -43, -22, -33, 15, 24, 4, 10, -125, 71, 33, -14, -104, 69, -86, -77, 63,
            53, -48, 23, 28, 14, -119, -60, 102, -45, 106, -35, -17, 25, -116, 10, -27,
            -57, 11, 18, -121, 77, -94, -75, -71, -73, 50, -10, -107, -122, -17, 34, -52,
            25, -107, -54, -17, 23, 12, 14, -123, -60, 99, 19, 105, -51, -18, -43, -116,
            95, 37, -8, 27, 2, -117, 65, -89, 112, 122, -92, 35, 59, 89, -45, 122, -35,
            -29, 25, -119, -54, -26, -41, 10, -34, -121, 24, 98, -118, -87, -89, 62, -6,
            -112, 67, 44, 49, -35, -44, 89, -97, 122, -24, 35, 14, -103, -60, 106, -45,
            111, 29, -20, 9, -115, -58, -27, -110, -53, 45, -105, 93, -82, -71, -68, 114,
            -15, -27, -124, 75, 35, 119, 89, -26, -70, -54, -13, 23, 5, -50, -125, 20, 97,
            -49, 104, 84, 46, -65, 92, 112, 57, -28, 18, -53, 77, -105, 117, -82, -89, 60,
            122, -111, -29, 44, 73, -35, -10, -39, -122, -38, -30, -37, 9, -101, 70, -21,
            114, -49, 101, -108, 43, 47, 95, 92, 56, 57, -46, -110, -35, -83, -103, -67,
            -86, -15, -65, 4, 112, 3, 100, 1, -21, 64, 79, 112, 52, 36, 23, 91, 78, -69,
            116, 115, 103, 101, -22, -85, 15, 63, 68, 16, 51, 76, 21, -11, -49, 7, 20, 2,
            -113, 65, -92, 48, 123, 84, 35, 127, 89, -32, 58, -56, 19, 22, -115, -50, -27,
            -108, 75, 47, 119, 92, 38, -71, -38, -14, -37, 5, -101, 67, 43, 113, -33, 100,
            88, 43, 122, -97, 99, 40, 41, -34, -98, -40, 104, 90, -82, -69, 60, 115, 81,
            -27, -4, 75, 1, -9, 64, 70, -80, 50, -12, 21, -121, 79, 34, -76, 25, -73, 74,
            -10, -73, 6, -10, -126, -58, -31, -110, -56, 109, -106, -83, -82, -3, -68, 65,
            -79, -16, 116, 68, 39, 115, 90, -91, -5, 59, 3, 83, 65, -3, -16, 65, -124, 48,
            99, 84, 41, -1, 94, -64, 56, 80, 18, -68, 13, -79, -59, -76, 83, 55, 125, -42,
            -95, -98, -8, 104, 66, -82, -79, -68, 116, 113, -25, 100, 74, -85, 119, 63,
            102, -112, 42, -20, 31, 13, -56, 5, -106, -125, 46, -31, -36, 72, 89, -10, -70,
            -58, -13, 18, -59, -51, -109, 21, -83, -49, 61, -108, 17, -81, 76, 124, 53,
            -31, -41, 8, 94, -122, -72, 98, -14, -87, -123, -66, -29, 48, 73, -44, 54, -33,
            86, -40, 62, -38, -112, 91, 44, 59, 93, -45, 121, -99, -30, -23, -119, -114,
            -26, -28, 74, -53, 119, 23, 102, -114, -86, -28, 127, 11, 96, 7, 104, 2, -82,
            -127, -68, 96, 113, -24, 36, 78, -101, 116, 107, 103, 111, 106, -84, 47, 61,
            -36, 17, -103, -52, 106, -43, -17, 31, 12, 8, 5, -58, -125, 18, -31, -51, -120,
            85, -90, -65, 58, -16, 19, 4, 13, -61, 69, -111, -13, 44, 69, -35, -13, 25,
            -123, -54, -29, 23, 9, -50, -122, -44, 98, -33, 105, -104, 46, -22, -100, 79,
            41, -12, 30, -57, 72, 82, -74, -67, -74, -15, -74, -60, 118, -45, 102, -35,
            -22, -39, -113, 26, -28, 11, 11, 71, 71, 114, -78, -91, -75, -69, 55, 51, 86,
            -107, -2, -17, 0, 76, 0, 53, -64, 23, 16, 14, -116, 4, 101, -61, 107, 17, -17,
            76, 76, 53, -11, -41, 7, 30, -126, -120, 97, -90, -88, 122, -2, -93, 0, 121,
            -64, 34, -48, 25, -100, 10, -23, -57, 14, -46, -124, 93, -93, 121, -71, -30,
            -14, -55, -123, -106, -29, 46, -55, -36, 86, -39, -2, -38, -64, 91, 16, 59, 76,
            19, 117, -51, -25, 21, -118, -113, 39, 36, 26, -101, 75, 43, 119, 95, 102, -72,
            42, -14, -97, 5, -88, 3, 62, -127, -48, 96, 92, 40, 57, -34, -110, -40, 109,
            -102, -83, -85, 61, -65, 81, -80, 60, 116, 17, -25, 76, 74, -75, -9, 55, 6,
            -106, -126, -18, -31, -116, 72, 101, -10, -85, 6, -1, 66, -64, 49, -112, 20,
            108, 15, 109, -60, 45, -109, 93, -83, -7, -67, -126, -15, -95, -124, 120, 99,
            98, -87, -23, -66, -50, -16, 84, 68, 63, 115, 80, 37, -4, 27, 1, -53, 64, 87,
            112, 62, -92, 16, 123, 76, 35, 117, -39, -25, 26, -54, -117, 23, 39, 78, -102,
            -76, 107, 55, 111, 86, -84, 62, -3, -48, 65, -100, 48, 105, -44, 46, -33, 92,
            88, 57, -6, -110, -61, 45, -111, -35, -84, 89, -67, -6, -15, -125, 4, 97, -61,
            104, 81, -18, -68, 76, 113, -11, -28, 71, 11, 114, -121, 101, -94, -85, 57,
            -65, 82, -16, 61, -124, 17, -93, 76, 121, -11, -30, -57, 9, -110, -122, -19,
            -94, -51, -71, -107, -78, -17, 53, -116, 23, 37, -50, -101, 20, 107, 79, 111,
            116, 44, 39, 93, -38, -71, -101, 50, -21, 85, -113, 127, 36, 32, 27, 88, 11,
            122, -121, 99, 34, -87, -39, -66, -38, -16, 91, 4, 59, 67, 83, 113, -3, -28,
            65, -117, 112, 103, 100, 42, -85, 95, 63, 120, 16, 34, -116, 25, -91, -54, -5,
            23, 3, 78, -127, -12, 96, 71, 104, 50, -82, -107, -68, 111, 49, -20, 20, 77,
            -49, 117, -108, 39, 47, 90, -100, 59, 41, -45, 94, -35, -8, 89, -126, -70, -31,
            -77, 8, 117, -58, -89, 18, -6, -115, -125, 37, -95, -37, 56, 91, 82, -69, 125,
            -77, 97, -75, -24, 119, 14, -90, -124, 122, -29, 99, 9, -23, -58, -50, -46,
            -44, 93, -97, 121, -88, 34, -2, -103, -128, 106, -32, 47, 8, 28, 6, -119, -62,
            -26, -47, -118, -36, 103, 25, -22, -118, -49, 39, 20, 26, -113, 75, 36, 55, 91,
            86, -69, 126, -13, 96, 69, -24, 51, 14, -107, -60, 111, 19, 108, 13, -19, -59,
            -115, -109, 37, -83, -37, 61, -101, 81, -85, 124, 127, 97, -32, 40, 72, 30,
            -74, -120, 118, -26, -90, -54, -6, -41, 3, 30, -127, -56, 96, 86, -88, 62, -2,
            -112, 64, 108, 48, 45, -44, 29, -97, 73, -88, 54, -2, -106, -64, 110, -48, 44,
            92, 29, -7, -55, -126, -42, -31, -98, -56, 104, 86, -82, -66, -4, 112, 65, -28,
            48, 75, 84, 55, 127, 86, -96, 62, -8, 16, 66, -116, 49, -91, -44, 123, 31, 99,
            72, 41, -10, -98, -58, -24, 82, -50, -67, -108, 113, -81, 100, 124, 43, 97,
            -33, 104, 88, 46, -70, -100, 115, 41, -27, -34, -53, 24, 87, 74, -66, -73, 48,
            118, -108, 38, -17, 90, -52, 59, 21, -45, 79, 29, -12, 9, -121, 70, -30, -78,
            -55, -75, -106, -9, 46, -58, -100, 82, -23, -3, -114, -63, -92, 80, 123, 124,
            35, 97, -39, -24, 90, -50, -69, 20, 115, 79, 101, -12, 43, 7, 95, 66, -72, 49,
            -78, -108, 117, -81, 103, 60, 42, -111, -33, 44, 88, 29, -6, -119, -125, 38,
            -31, -38, -56, 91, 22, -69, 78, -13, 116, 69, -25, 115, 10, -91, -57, 59, 18,
            -109, 77, -83, -11, -67, -121, 49, -94, -108, 121, -81, 98, -4, 41, -127, -34,
            -32, 88, 72, 58, -74, -109, 54, -19, -42, -51, -98, -43, -88, 95, 62, -72, 16,
            114, -116, 37, -91, -37, 59, 27, 83, 75, 125, -9, 97, -122, -88, 98, -2, -87,
            -128, 126, -32, 32, 72, 24, 54, -118, -106, -25, 46, -54, -100, 87, 41, -2,
            -98, -64, 104, 80, 46, -68, 28, 113, -55, -28, 86, -53, 126, -41, 96, 94, -88,
            56, 126, -110, -96, 109, -72, 45, -78, -99, -75, -87, -73, 62, -10, -112, 70,
            -20, 50, -51, -43, -107, -97, 47, 40, 28, 30, -119, -56, 102, -42, -86, -34,
            -1, 24, 64, 10, -80, 7, 52, 2, -105, 65, -82, -80, 124, 116, 33, -25, 88, 74,
            -70, -73, 51, 54, -107, -42, -17, 30, -52, 8, 85, -58, -65, 18, -16, 13, -124,
            5, -93, 67, 57, -15, -46, -60, 93, -109, 121, -83, -30, -3, -119, -127, -90,
            -32, 122, -56, 35, 22, -103, -50, -22, -44, 79, 31, 116, 8, 39, 70, -102, -78,
            -21, 53, -113, 87, 36, 62, -101, 80, 107, 124, 47, 97, -36, 40, 89, -34, -70,
            -40, 115, 26, -91, -53, 59, 23, 83, 78, -67, -12, 113, -121, 100, 98, -85, 105,
            -65, 110, -16, 44, 68, 29, -13, 73, -123, -10, -29, 6, -55, -62, -42, -47, -98,
            -36, 104, 89, -18, -70, -52, 115, 21, -27, -49, 11, 20, 7, 79, 66, -76, 49,
            -73, 84, 118, -65, 102, -16, 42, -60, 31, 19, 72, 13, -10, -123, -122, -29, 34,
            -55, -39, -106, -38, -18, -37, 12, 91, 69, -5, 115, 3, 101, -63, -21, 16, 79,
            76, 52, 53, -41, 87, 30, -66, -120, 112, 102, -92, 42, -5, 95, 3, 120, 1, -30,
            -128, 73, -96, 54, -8, 22, -62, -114, -47, -92, 92, 123, 121, -29, 98, -55,
            -23, -106, -50, -18, -44, 76, 95, 117, -8, 39, 2, -102, -127, -85, 32, 127, 88,
            32, 58, -104, 19, 42, -115, -33, 37, -104, 27, 42, -117, 95, 39, 120, 26, -94,
            -117, 57, -89, 82, -6, -67, -125, 49, -95, -44, 120, 95, 98, -72, 41, -78, -98,
            -11, -88, 71, 62, -78, -112, 117, -84, 39, 61, -38, -111, -101, 44, 107, 93,
            -17, 121, -116, 34, -27, -39, -117, 26, -25, 75, 10, -73, 71, 54, -78, -106,
            -11, -82, -57, 60, 82, -111, -3, -84, 65, -67, -16, 113, -124, 36, 99, 91, 105,
            -5, 110, -61, 108, 81, -19, -4, 77, -127, -11, -96, 71, 56, 50, -110, -107,
            -83, -81, 61, -68, 17, -79, -52, 116, 85, -25, 127, 10, -96, 7, 56, 2, -110,
            -127, -83, -96, 125, -72, 33, -78, -104, 117, -86, -89, 63, 58, -112, 19, 44,
            13, -35, -59, -103, -109, 42, -19, -33, 13, -104, 5, -86, -125, 63, 33, -48,
            24, 92, 10, -71, -57, 50, -46, -107, -99, -81, 41, -68, 30, -15, -56, 68, 86,
            -77, 126, -11, -32, 71, 8, 50, -122, -107, -94, -17, 57, -116, 18, -27, -51,
            -117, 21, -89, 79, 58, -76, 19, 55, 77, -42, -75, -98, -9, 40, 70, -98, -78,
            -24, 117, -114, -89, 36, 122, -101, 99, 43, 105, -33, 110, -40, 44, 90, -99,
            -5, 41, -125, 94, -31, -8, 72, 66, -74, -79, -74, -12, 118, -57, 102, -46, -86,
            -35, -65, 25, -80, 10, -12, 7, 7, 66, -126, -79, -95, -76, 120, 119, 98, -90,
            -87, -70, -2, -13, 0, 69, -64, 51, 16, 21, -52, 15, 21, -60, 15, 19, 68, 13,
            -13, 69, -123, -13, 35, 5, -39, -61, 26, -47, -53, 28, 87, 73, -2, -74, -64,
            118, -48, 38, -36, 26, -39, -53, 26, -41, 75, 30, -73, 72, 118, -74, -90, -10,
            -6, -58, -61, 18, -47, -51, -100, 85, -87, -1, 62, -64, 16, 80, 12, 60, 5, -47,
            -61, 28, 81, -55, -4, 86, -63, -2, -48, 64, 92, 48, 57, -44, 18, -33, 77, -104,
            53, -86, -105, 63, 46, -112, 28, 108, 9, -19, -58, -51, -110, -43, -83, -97,
            61, -88, 17, -66, -116, 112, 101, -28, 43, 11, 95, 71, 120, 50, -94, -107, -71,
            -81, 50, -4, 21, -127, -49, 32, 84, 24, 63, 74, -112, 55, 44, 22, -99, -50,
            -23, -108, 78, -17, 116, 76, 39, 117, -38, -89, 27, 58, -117, 83, 39, 125, -38,
            -95, -101, 56, 107, 82, -81, 125, -68, 33, -79, -40, 116, 90, -89, 123, 58,
            -93, 83, 57, -3, -46, -63, -99, -112, 105, -84, 46, -3, -36, 65, -103, -16,
            106, -60, 47, 19, 92, 13, -7, -59, -126, -45, 33, -99, -40, 105, -102, -82,
            -21, 60, 79, 81, -12, 60, 71, 81, -14, -68, 69, -79, -13, 52, 69, -41, 115, 30,
            -91, -56, 123, 22, -93, 78, -7, -12, 66, -57, 113, -110, -92, 109, -69, 109,
            -77, 109, -75, -19, -73, 13, -74, -123, -74, -29, 54, -55, -42, -42, -34, -34,
            -40, 88, 90, -70, -69, 51, 51, -1, 63};

    private static final byte[] PREAMBLE = {(byte) 0xA4, (byte) 0xF2};
    private static final byte[] ACCESS_CODE = {(byte) 0xAC, (byte) 0xDD, (byte) 0xA4,
            (byte) 0xE2, (byte) 0xF2, (byte) 0x8C, (byte) 0x20, (byte) 0xFC};
    private static final int HEADER_LENGTH = 4;

    private Gnuradio() {}

    private static int calculateCrc32(byte[] bytes) {
        int crc = 0xffffffff;

        for (byte aByte : bytes) {
            crc = CRC32_TABLE[aByte ^ ((crc >> 24) & 0xff)] ^ (crc << 8);
        }

        return ~crc;
    }

    public static byte[] makePacket(byte[] payload) {
        return makePacket(payload, 1, "NONE");
    }

    public static byte[] makePacket(byte[] payload, int repeat) {
        return makePacket(payload, repeat, "NONE");
    }

    public static byte[] makePacket(byte[] payload, int repeat, String interleave) {
        int i;
        int length;
        int pos = 0;
        byte[] bytes;
        int crc = calculateCrc32(payload);
        byte[] payloadWithCrc = new byte[payload.length + 4];

        for (i = 0; i < payload.length; i++) {
            payloadWithCrc[i] = payload[i];
        }

        for (i = 3; i >= 0; i--) {
            byte b = (byte) (crc >> (8 * i) & 0xff);
            payloadWithCrc[3 + payload.length - i] = b;
        }

        if (repeat > 1) {
            payloadWithCrc = ModulationTools.repeat(payloadWithCrc, repeat);
        }

        if (interleave.equals("INTERLEAVE")) {
            payloadWithCrc = ModulationTools.interleave(payloadWithCrc, repeat);
        } else if (interleave.equals("SCRAMBLE")) {
            payloadWithCrc = ModulationTools.shuffleEncode(payloadWithCrc);
        }

        length = (short) (
                PREAMBLE.length +
                ACCESS_CODE.length +
                HEADER_LENGTH +
                payloadWithCrc.length +
                5 /* Stop byte(s) (only one needed, repetition for easier detection on failures)  */
        );
        bytes = new byte[length];

        for (i = 0; i < PREAMBLE.length; i++) {
            bytes[pos++] = PREAMBLE[i];
        }

        for (i = 0; i < ACCESS_CODE.length; i++) {
            bytes[pos++] = ACCESS_CODE[i];
        }

        for (i = 0; i < 2; i++) {
            bytes[pos++] = (byte) ((payloadWithCrc.length >> 8) & 0x0f);
            bytes[pos++] = (byte) (payloadWithCrc.length & 0xff);
        }


        for (i = 0; i < payloadWithCrc.length; i++) {
            bytes[pos++] = (byte) ((payloadWithCrc[i] ^ GNURADIO_MASK[i]) & 0xff);
        }

        for (i = 0; i < 5;i++) {
            bytes[pos++] = 0x55;
        }

        return bytes;
    }

    public static double[] generateGaussianTaps(double gain, double spb, double bt, int ntaps) {
        double[] taps = new double[ntaps];
        double scale  = 0;
        double dt     = 1.0 / spb;
        double s      = 1.0 / (Math.sqrt(Math.log(2.0)) / (2 * Math.PI * bt));
        double t0     = -0.5 * ntaps;
        double ts;

        for (int i = 0; i < ntaps; i++) {
            t0++;
            ts      = s * dt * t0;
            taps[i] = Math.exp(-0.5 * ts * ts);
            scale  += taps[i];
        }

        for(int i = 0; i < ntaps; i++) {
            taps[i] = taps[i] / scale * gain;
        }

        return taps;
    }
}
